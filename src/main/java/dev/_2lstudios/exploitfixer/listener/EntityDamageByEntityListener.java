package dev._2lstudios.exploitfixer.listener;

import org.bukkit.entity.Entity;
import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.EventPriority;
import org.bukkit.event.Listener;
import org.bukkit.event.entity.EntityDamageByEntityEvent;

import dev._2lstudios.exploitfixer.managers.ModuleManager;
import dev._2lstudios.exploitfixer.modules.PatcherModule;
import dev._2lstudios.exploitfixer.modules.NotificationsModule;

public class EntityDamageByEntityListener implements Listener {
	private NotificationsModule notificationsModule;
	private PatcherModule eventsModule;

	EntityDamageByEntityListener(ModuleManager moduleManager) {
		this.notificationsModule = moduleManager.getNotificationsModule();
		this.eventsModule = moduleManager.getPatcherModule();
	}

	@EventHandler(priority = EventPriority.LOWEST, ignoreCancelled = true)
	public void onEntityDamageByEntity(EntityDamageByEntityEvent event) {
		if (!eventsModule.isSelfDamage()) {
			return;
		}

		Entity entity = event.getEntity();

		if (entity instanceof Player) {
			Entity damager = event.getDamager();

			if (damager instanceof Player && entity == damager) {
				event.setCancelled(true);
				notificationsModule.debug("[Patcher] Cancelled self damage by " + entity.getName() + "!");
			}
		}
	}
}
