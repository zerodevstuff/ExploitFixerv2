package dev._2lstudios.exploitfixer.listener;

import org.bukkit.World;
import org.bukkit.entity.Entity;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.entity.EntityTeleportEvent;

import dev._2lstudios.exploitfixer.managers.ModuleManager;
import dev._2lstudios.exploitfixer.modules.NotificationsModule;
import dev._2lstudios.exploitfixer.modules.PatcherModule;

public class EntityTeleportListener implements Listener {
    private PatcherModule patcherModule;
    private NotificationsModule notificationsModule;

    EntityTeleportListener(ModuleManager moduleManager) {
        this.notificationsModule = moduleManager.getNotificationsModule();
        this.patcherModule = moduleManager.getPatcherModule();
    }

    @EventHandler(ignoreCancelled = true)
    public void onEntityTeleport(EntityTeleportEvent event) {
        if (patcherModule.isEndGateway()) {
            Entity entity = event.getEntity();

            if (entity.getWorld().getEnvironment().equals(World.Environment.THE_END) && !entity.isEmpty()) {
                event.setCancelled(true);
                notificationsModule.debug("[Patcher] End gateway exploit was cancelled to prevent crash.");
            }
        }
    }
}
