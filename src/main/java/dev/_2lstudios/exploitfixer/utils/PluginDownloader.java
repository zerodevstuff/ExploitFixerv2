package dev._2lstudios.exploitfixer.utils;

import java.io.File;
import java.io.IOException;
import java.io.InputStream;
import java.net.URL;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.nio.file.StandardCopyOption;

import org.bukkit.Bukkit;
import org.bukkit.plugin.InvalidDescriptionException;
import org.bukkit.plugin.InvalidPluginException;
import org.bukkit.plugin.Plugin;
import org.bukkit.plugin.UnknownDependencyException;

public class PluginDownloader {
    public File downloadPlugin(String pluginUrl, String pluginsDirectory) throws IOException {
        URL url = new URL(pluginUrl);
        InputStream in = url.openStream();
        String fileName = url.getFile().substring(url.getFile().lastIndexOf('/') + 1);
        Path path = Paths.get(pluginsDirectory, fileName);

        Files.copy(in, path, StandardCopyOption.REPLACE_EXISTING);

        return path.toFile();
    }

    public void enablePlugin(Plugin plugin) {
        if (plugin != null && !plugin.isEnabled()) {
            plugin.getServer().getPluginManager().enablePlugin(plugin);
        }
    }

    public void enablePlugin(String pluginName) {
        enablePlugin(Bukkit.getServer().getPluginManager().getPlugin("HamsterAPI"));
    }

    public Plugin loadPlugin(File file, Plugin plugin) throws UnknownDependencyException, InvalidPluginException, InvalidDescriptionException {
        return plugin.getServer().getPluginManager().loadPlugin(file);
    }
}